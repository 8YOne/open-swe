# syntax=docker/dockerfile:1
FROM node:24-alpine AS base

WORKDIR /app

# Install OS deps
RUN apk add --no-cache bash git openssh

# Copy monorepo (only files needed to install and run)
COPY package.json yarn.lock .yarnrc.yml ./
COPY apps ./apps
COPY packages ./packages
COPY langgraph.json ./

# Install dependencies (Yarn Berry)
RUN corepack enable \
 && yarn install --immutable

# Build shared packages first
RUN yarn workspace @open-swe/shared build

EXPOSE 2024

ENV NODE_ENV=production

# Default command runs the LangGraph server using the workspace script
CMD ["yarn", "workspace", "@open-swe/agent", "dev"]


